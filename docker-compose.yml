version: "3.9"

services:
  nginx-proxy:
    build:
      context: .
      dockerfile: docker/nginx-proxy.Dockerfile
    image: "${TB_DOCKER_NAMESPACE:-tradebot-local}/nginx-proxy:${TRADEBOT_TAG:-dev}"
    container_name: nginx-proxy
    depends_on:
      - tv-listener
    ports:
      - "80:80"
    networks:
      - tradebot-net

  tv-listener:
    build:
      context: .
      dockerfile: docker/tv-listener.Dockerfile
    image: "${TB_DOCKER_NAMESPACE:-tradebot-local}/tv-listener:${TRADEBOT_TAG:-dev}"
    container_name: tv-listener
    ports:
      - "8000:8000"
    environment:
      - SIGNAL_ORCHESTRATOR_URL=http://signal-orchestrator:8001
    depends_on:
      - signal-orchestrator
    networks:
      - tradebot-net

  signal-orchestrator:
    build:
      context: .
      dockerfile: docker/signal-orchestrator.Dockerfile
    image: "${TB_DOCKER_NAMESPACE:-tradebot-local}/signal-orchestrator:${TRADEBOT_TAG:-dev}"
    container_name: signal-orchestrator
    ports:
      - "8001:8001"
    environment:
      - ORDER_GATEWAY_URL=http://order-gateway:8002
    env_file:
      - .env.bingx
    depends_on:
      - order-gateway
    networks:
      - tradebot-net

  order-gateway:
    build:
      context: .
      dockerfile: docker/order-gateway.Dockerfile
    image: "${TB_DOCKER_NAMESPACE:-tradebot-local}/order-gateway:${TRADEBOT_TAG:-dev}"
    container_name: order-gateway
    ports:
      - "8002:8002"
    env_file:
      - .env.bingx
    networks:
      - tradebot-net

  telegram-source:
    build:
      context: .
      dockerfile: docker/telegram-source.Dockerfile
    image: "${TB_DOCKER_NAMESPACE:-tradebot-local}/telegram-source:${TRADEBOT_TAG:-dev}"
    container_name: telegram-source
    environment:
      - TELEGRAM_API_ID=${TELEGRAM_API_ID}
      - TELEGRAM_API_HASH=${TELEGRAM_API_HASH}
      - TELEGRAM_ACCOUNT_ID=${TELEGRAM_ACCOUNT_ID:-ta01}
      - TELEGRAM_POCKETOPTION_CHANNEL_ID=${TELEGRAM_POCKETOPTION_CHANNEL_ID}
      - TELEGRAM_SESSION_DIR=/app/telegram/sessions
      - POCKETOPTION_BOT_URL=${POCKETOPTION_BOT_URL:-http://pocketoption-bot:8080/place_trade}
      - POCKETOPTION_DRY_RUN=${POCKETOPTION_DRY_RUN:-true}
    volumes:
      - "${HOME}/tradebot-data/telegram/sessions:/app/telegram/sessions"
    depends_on:
      - pocketoption-bot
    restart: always
    networks:
      - tradebot-net

  pocketoption-bot:
    build:
      context: .
      dockerfile: docker/pocketoption-bot.Dockerfile
    image: "${TB_DOCKER_NAMESPACE:-tradebot-local}/pocketoption-bot:${TRADEBOT_TAG:-dev}"
    container_name: pocketoption-bot
    ports:
      - "8080:8080"
    environment:
      - POCKETOPTION_ENABLED=${POCKETOPTION_ENABLED:-true}
      - POCKETOPTION_DRY_RUN=${POCKETOPTION_DRY_RUN:-true}
      - POCKETOPTION_BASE_STAKE=${POCKETOPTION_BASE_STAKE:-1.0}
      - POCKETOPTION_MAX_STAKE_PER_TRADE=${POCKETOPTION_MAX_STAKE_PER_TRADE:-}
      - POCKETOPTION_ACCOUNT_TYPE=${POCKETOPTION_ACCOUNT_TYPE:-DEMO}
    restart: always
    networks:
      - tradebot-net

networks:
  tradebot-net:
    driver: bridge

